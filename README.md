# SPO æ˜¯ä»€ä¹ˆ

![SPO-method](https://s2.loli.net/2025/02/21/D7MpUjFhLZTxoGd.png)

SPOï¼ˆSelf-Supervised Prompt Optimizationï¼‰æ˜¯ä¸€ç§åŸºäºå¤§è¯­è¨€æ¨¡å‹è‡ªç›‘ç£èƒ½åŠ›çš„æç¤ºä¼˜åŒ–æ¡†æ¶ã€‚ä¸ä¼ ç»Ÿä¾èµ–äººå·¥æ ‡æ³¨æˆ–åŸºå‡†ç­”æ¡ˆçš„æ–¹æ³•ä¸åŒï¼ŒSPOé€šè¿‡å¯¹æ¯”ä¸åŒæç¤ºç”Ÿæˆçš„è¾“å‡ºè´¨é‡ï¼Œè‡ªä¸»å®Œæˆä¼˜åŒ–è¿­ä»£ã€‚

è¯¥æ¡†æ¶åˆ›æ–°æ€§åœ°å°†ä¼˜åŒ–è¿‡ç¨‹åˆ†è§£ä¸ºæ‰§è¡Œ-è¯„ä¼°-ä¼˜åŒ–ä¸‰é˜¶æ®µå¾ªç¯ï¼Œåˆ©ç”¨LLMè‡ªèº«å¯¹ä»»åŠ¡éœ€æ±‚çš„ç†è§£èƒ½åŠ›ï¼Œé€šè¿‡æˆå¯¹æ¯”è¾ƒè¾“å‡ºç»“æœè·å¾—ä¼˜åŒ–ä¿¡å·ã€‚**è‡ªç›‘ç£æç¤ºä¼˜åŒ–ï¼ˆSPOï¼‰**ç›¸è¾ƒäºä¼ ç»Ÿæ–¹æ³•ï¼Œå®ç°äº†ä¼˜ç§€çš„æ€§èƒ½ï¼Œä½¿å¾—æˆæœ¬æ•ˆç‡é«˜å‡º17.8-90.9å€ã€‚ğŸš€

# å†å²æ›´æ–°æ—¥å¿—

## 2025.03.03
- ä¼˜åŒ–äº†ç•Œé¢çŠ¶æ€ç®¡ç†ï¼Œåœ¨`app.py`æ·»åŠ äº†`is_optimizing` çŠ¶æ€æ¥æ§åˆ¶åœ¨ä¼˜åŒ–æç¤ºè¯æ—¶ç•Œé¢çš„äº¤äº’ã€‚
- æ”¹è¿›äº†`metagpt/ext/spo/utils/llm_client.py`é…ç½®æ–‡ä»¶çš„å¤„ç†é€»è¾‘ï¼Œæ”¯æŒä¿å­˜å’ŒåŠ è½½æŒ‡å®šçš„æ¨¡å‹é…ç½®æ–‡ä»¶ï¼Œé¿å…äº†åœ¨äº‘ç«¯éƒ¨ç½²é¡¹ç›®æ—¶ä¼šå¯¼è‡´æ•æ„Ÿæ•°æ®æ³„æ¼çš„é—®é¢˜ã€‚ï¼ˆå› ä¸ºåŸ`llm_client.py`é»˜è®¤é€šè¿‡`ModelsConfig`ç±»ä½¿ç”¨çš„`default`æ–¹æ³•åŠ è½½æ¨¡å‹é…ç½®ï¼Œä¼šé»˜è®¤å›ºå®šåŠ è½½`config/config2.yaml`é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¢åŠ æŒ‡å®šæ–‡ä»¶è·¯å¾„çš„é€»è¾‘å¹¶é€šè¿‡`ModelsConfig`ç±»çš„`from_home`æ–¹æ³•åŠ è½½ä¸Šä¼ åˆ°`config/`ä¸­çš„yamlé…ç½®æ–‡ä»¶ã€‚ï¼‰
- ä¿®å¤äº†`app.py`åœ¨æ¨¡ç‰ˆé…ç½®åˆå§‹åŒ–æ—¶é—®ç­”ç¤ºä¾‹åŠ è½½ä¸å…¨ï¼Œä»¥åŠæ·»åŠ ç¤ºä¾‹åä¼˜åŒ–æ—¶æŠ¥é”™çš„é—®é¢˜ã€‚
- ä¿®å¤äº†`app.py`åœ¨æ¨¡ç‰ˆé…ç½®è¾“å…¥é—®ç­”ç¤ºä¾‹æ—¶ï¼Œç”±äºåˆå§‹åŒ–ç¤ºä¾‹æ—¶åŠ è½½ä¸å…¨çš„BUGï¼Œåœ¨Qå†™å®Œååˆ‡æ¢åˆ°è¾“å…¥Aåå‡ºç°é¡µé¢å†…å®¹é‡æ–°"åˆ·æ–°"çš„é—®é¢˜ã€‚

# å¦‚ä½•è¿è¡Œ SPO

## é€šè¿‡é•œåƒä¸€é”®éƒ¨ç½²å’Œè¿è¡Œ

åœ¨è¿™é‡Œç‰¹åˆ«æ„Ÿè°¢ `UCloud` ä¼˜äº‘æ™ºç®—æä¾›çš„ GPU ç®—åŠ›æ”¯æŒï¼è®©é¡¹ç›®å¾—åˆ°äº†å¿«é€Ÿçš„éƒ¨ç½²å’Œè°ƒè¯•è¿è¡Œã€‚

### UCloud ä»‹ç»

![UCloud](https://s2.loli.net/2025/02/13/dDV4fosLACQgpmJ.png)

> ä¼˜äº‘æ™ºç®—æ˜¯ UCloud ä¼˜åˆ»å¾—çš„GPUç®—åŠ›ç§Ÿèµå¹³å°ï¼Œä¸“æ³¨äºä¸ºç”¨æˆ·æä¾›çµæ´»çš„ç®—åŠ›èµ„æºã€‚æ”¯æŒæŒ‰å¤©ã€æŒ‰å°æ—¶çŸ­æœŸç§ŸèµåŠåŒ…æœˆé•¿æœŸç§Ÿèµï¼Œæ»¡è¶³å„ç±»éœ€æ±‚ã€‚
> 
> ç»“åˆä¸°å¯Œçš„å…¬å…±é•œåƒç¤¾åŒºï¼Œä¼˜äº‘æ™ºç®—æä¾›å¤šç§é¢„é…ç½®çš„å®¹å™¨é•œåƒï¼Œå¦‚LLamaFactoryã€SD-webUI å’Œ LLM ç­‰ï¼Œå®ç°ä¸€é”®éƒ¨ç½²ï¼Œ5åˆ†é’Ÿå°±èƒ½å¿«é€Ÿä¸Šæ‰‹ AIï¼ŒåŠ©åŠ›ç”¨æˆ·å¿«é€Ÿå¯åŠ¨å’Œæ‰©å±•é¡¹ç›®ã€‚

### 1. ä½¿ç”¨è¯¥é•œåƒåˆ›å»ºå®ä¾‹

**é•œåƒå‘å¸ƒé¡µï¼ˆç¥ç§˜é€šé“ï¼‰**ï¼š<https://www.compshare.cn/images-detail?ImageID=compshareImage-18u5hmtunbzm&referral_code=4sOb83sEXe4BLkKYqw9G4P&ytag=GPU_hych_Lcsdn_csdn_display>

>ã€ç®—åŠ›ç¦åˆ©é€Ÿé€’ã€‘ç¥ç§˜é€šé“ç§’é¢†40æšç®—åŠ›é‡‘å¸è§£é”20å°æ—¶é¡¶é…4090æ˜¾å¡è¯•é©¾ä½“éªŒï¼å­¦ç”Ÿå…š/èŒåœºäººäº®å‡ºå¤§ä½¬èº«ä»½ï¼Œç«‹äº«æ°¸ä¹…VIP+é¢å¤–é‡‘å¸è¡¥ç»™åŒ…ï¼Œå¿«ä¹ç™½å«–æ‰‹æ…¢æ— ~

é¦–å…ˆï¼Œåœ¨`é•œåƒå‘å¸ƒé¡µ`å¯ä»¥æŸ¥çœ‹åˆ°æˆ‘åˆ¶ä½œå®Œæˆå¹¶åˆ†äº«åˆ°å¹³å°çš„å®ä¾‹é•œåƒï¼Œé€šè¿‡å³ä¾§çš„`ä½¿ç”¨è¯¥é•œåƒåˆ›å»ºå®ä¾‹`å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚

![UCloud_use_mirror](https://s2.loli.net/2025/02/27/C2n4pcISifrqXsb.png)

### 2. éƒ¨ç½²GPUå®ä¾‹

å¯æŒ‰éœ€é€‰æ‹©é…ç½®åå†`ç«‹å³éƒ¨ç½²`ã€‚

![UCloud_mirror_ini](https://s2.loli.net/2025/02/27/bmWo37YZvtkgqIL.png)

### 3. å¯åŠ¨å®ä¾‹

ç¨ç­‰ç‰‡åˆ»åï¼Œå®ä¾‹å°±ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨ï¼Œé€šè¿‡æŸ¥çœ‹`å®ä¾‹åˆ—è¡¨`å¯æŸ¥çœ‹å®ä¾‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶æ”¯æŒéšæ—¶å…³é—­æˆ–å¯ç”¨ã€‚

![UCloud_contorl](https://s2.loli.net/2025/02/13/Jw9BvKVS5POXW2k.png)

å®ä¾‹åŒæ—¶æä¾›äº†ä¸€ä¸ª `JupyterLab` åº”ç”¨ä½œä¸ºäº¤äº’å¼å¼€å‘ç¯å¢ƒï¼Œå®ƒæä¾›äº†æ›´ç°ä»£åŒ–å’Œçµæ´»çš„ç”¨æˆ·ç•Œé¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç»§ç»­åç»­çš„æ­¥éª¤ã€‚

![UCloud_JupyterLab](https://s2.loli.net/2025/02/13/utpxBdQqGCMOZSA.png)

### 4. è¿è¡Œ SPO WebUI æœåŠ¡

å¯åŠ¨å®ä¾‹åï¼Œä½ å¯ä»¥é€šè¿‡ `JupyterLab` åº”ç”¨çš„ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å¿«é€Ÿå¯åŠ¨æœåŠ¡ï¼š
```bash
python -m streamlit run app.py
```

WebUI æœåŠ¡é»˜è®¤é€šè¿‡ `8501` ç«¯å£è¿›è¡Œè®¿é—®ï¼Œé•œåƒå·²ç»é…ç½®äº†ç«¯å£è½¬å‘ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡`https://{å…¬ç½‘IP}:8501/`è®¿é—®ã€‚

![SPO-LLM-ini](https://s2.loli.net/2025/02/21/QX5gSr9umoOwHd3.png)

### 5. é…ç½® LLM API

é¦–æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œé»˜è®¤åœ¨**æ¨¡å‹è®¾ç½®**ä¸­æ²¡æœ‰é¢„ç½®æ¨¡å‹å¯ä»¥é€‰æ‹©çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆé…ç½® LLM API å’Œç›¸åº”çš„æ¨¡å‹åç§°ï¼Œè¿™é‡Œæˆ‘ä»¥é…ç½®é˜¿é‡Œç™¾ç»ƒå¤§æ¨¡å‹ä¸ºä¾‹ã€‚

é…ç½®å®Œæˆåï¼Œç‚¹å‡»**è¿é€šæ€§æµ‹è¯•å¹¶æ·»åŠ æ¨¡å‹**å¹¶ç­‰å¾…æµ‹è¯•ï¼Œæµ‹è¯•æˆåŠŸåå°±ä¼šå°†æ¨¡å‹ä¿å­˜åˆ°æœ¬åœ°é…ç½®ä¸­ï¼Œä¹‹åä½ ä¼šå‘ç°åœ¨ä¸‹æ–¹çš„**æ¨¡å‹è®¾ç½®***ä¸­å¢åŠ äº†ç›¸åº”çš„æ¨¡å‹é€‰é¡¹ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ç›¸åŒ/ä¸åŒçš„æ¨¡å‹ä½œä¸ºä¼˜åŒ–æç¤ºã€è¯„ä¼°æç¤ºå’Œæ‰§è¡Œæç¤ºï¼ˆæµ‹è¯•ä¼˜åŒ–åæç¤ºè¯ï¼‰çš„æ¨¡å‹ã€‚

![SPO-LLM-Setting](https://s2.loli.net/2025/02/27/687CfvmwPlWhY4D.png)

### 6. é…ç½®ä¼˜åŒ–å™¨

æ»‘åŠ¨åˆ°**LLM é…ç½®**çš„æœ€ä¸‹æ–¹ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ª**ä¼˜åŒ–å™¨è®¾ç½®**ï¼Œè¿™é‡Œçš„åˆå§‹è½®æ¬¡å’Œæœ€å¤§è½®æ¬¡ï¼Œä½ å¯ä»¥æŒ‰ç…§éœ€è¦é…ç½®å®ƒä»¬çš„æ¬¡æ•°ã€‚

![SPO-Optimize-times](https://s2.loli.net/2025/02/27/8qdHZ2hFvw1LP3B.png)

### 7. é…ç½®æç¤ºæ¨¡ç‰ˆ

æ¥åˆ°**æ¨¡æ¿é…ç½®**é¡µï¼Œè¿™é‡Œæä¾›äº†ä¸€ä¸ªæç¤ºè¯çš„é…ç½®æ¨¡æ¿ï¼Œæ˜¯SPOæ¡†æ¶çš„æ ¸å¿ƒé…ç½®ï¼Œè¿™å†³å®šäº†ä½ æƒ³ä¼˜åŒ–çš„æç¤ºè¯ä»¥åŠä¼˜åŒ–çš„ç›®æ ‡ã€‚

- **æç¤ºè¯**ï¼šè¾“å…¥ä½ æƒ³è¦ä¼˜åŒ–çš„æç¤ºè¯ï¼Œä¸»è¦ç”¨äºä¼˜åŒ–æ¨¡å‹ä¼˜åŒ–æç¤ºè¯ã€‚
- **è¦æ±‚**ï¼šè¾“å…¥æç¤ºè¯ä¼˜åŒ–çš„ç›®æ ‡ï¼Œæˆ–è€…æ˜¯ä¸€æ®µæè¿°ï¼ˆæè¿°å¯¹æç¤ºè¯è¾“å‡ºç»“æœçš„è¦æ±‚ï¼‰ï¼Œä¸»è¦ç”¨äºè¯„ä¼°æ¨¡å‹è¯„ä¼°æç¤ºè¯ã€‚
- **é—®ç­”ç¤ºä¾‹[å¯é€‰]**ï¼šå¯ä»¥æ·»åŠ å¤šä¸ªQ&Aä½œä¸ºç¤ºä¾‹ï¼Œå¯ä»¥æ›´å¥½åœ°æŒ‡å¯¼æ¨¡å‹ä¼˜åŒ–æç¤ºè¯å‘ç›®æ ‡å¯¹é½ã€‚

![SPO-Prmopt-Setting](https://s2.loli.net/2025/02/27/yeZEXra2jlK7wBq.png)

### 8. å¼€å§‹ä¼˜åŒ–

å®Œæˆ**æ¨¡æ¿é…ç½®**åï¼Œä½ å°±å¯ä»¥è¿›å…¥**ä¼˜åŒ–æ—¥å¿—**é¡µï¼Œç‚¹å‡»**å¼€å§‹ä¼˜åŒ–**æ‰§è¡ŒSPOè„šæœ¬å¼€å§‹ä¼˜åŒ–æç¤ºè¯äº†ï¼å¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥ä»é¡µé¢çœ‹åˆ°ä¼˜åŒ–çš„è¿‡ç¨‹å’Œæ¨¡å‹è¾“å…¥è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯ã€‚Enjoy itï¼

![SPO-log](https://s2.loli.net/2025/02/27/pWJcMei6ayzb3S8.png)

### 9. æŸ¥çœ‹ä¼˜åŒ–ç»“æœ

æˆ‘è¿™é‡Œä¸ºäº†å¿«é€Ÿæ¼”ç¤ºï¼Œè®¾ç½®æœ€å¤§è½®æ¬¡ä¸º3æ¬¡ã€‚åœ¨ç­‰å¾…ç»“æŸä¼˜åŒ–ä¹‹åï¼Œä½ å¯ä»¥è·³è½¬åˆ°**ä¼˜åŒ–ç»“æœ**é¡µï¼Œä½ å°†ä¼šçœ‹åˆ°æ¯ä¸€è½®ä¼˜åŒ–çš„æç¤ºã€å®ŒæˆçŠ¶æ€å’Œè¯¦ç»†çš„ä¼˜åŒ–ç»“æœã€‚

![SPO-Results](https://s2.loli.net/2025/02/27/gtrZm9JyBRqYF3T.png)

ç‚¹å¼€å¯¹åº”è½®æ¬¡ï¼Œä½ å¯ä»¥çœ‹åˆ°æ›´åŠ è¯¦ç»†çš„ä¼˜åŒ–ç»“æœï¼Œè¿™é‡Œæˆ‘å…ˆæŸ¥çœ‹å¼€**è½®æ¬¡1**çš„ä¼˜åŒ–ç»“æœï¼Œå‘ç°ç¬¬1è½®çš„æç¤ºè¯æ˜¯ä½ è¾“å…¥çš„æç¤ºè¯ï¼Œå®ƒå°†é¦–å½“å…¶å†²ä½œä¸ºæç¤ºè¯ï¼Œè¾“å…¥åˆ°æ¨¡å‹ä¸­è¿›è¡Œä¼˜åŒ–å’Œè¯„ä¼°ï¼Œä¸ºåç»­ä¼˜åŒ–æç¤ºè¯çš„è¿›ç¨‹ä½œå‡†å¤‡ã€‚

![SPO-Result-1](https://s2.loli.net/2025/02/27/N7cMYuQE9qDn2JO.png)

æ¥ç€ï¼Œæˆ‘å†æŸ¥çœ‹å¼€**è½®æ¬¡3**çš„ä¼˜åŒ–ç»“æœï¼Œå‘ç°ä¸åŒäºç¬¬1è½®çš„æç¤ºè¯ï¼Œå½“ä¼˜åŒ–è¿›ç¨‹è¾¾åˆ°ç¬¬3è½®æ—¶ï¼Œæç¤ºè¯å·²ç»å˜å¾—æ›´åŠ ç»†è‡´å®Œæ•´äº†ï¼Œåƒè¿™æ ·æ›´å®Œå–„çš„æç¤ºè¯ï¼Œèƒ½å¤Ÿåœ¨æµ‹è¯•æ—¶æ›´å¥½åœ°æŒ‡å¯¼æ¨¡å‹è¾“å‡ºï¼Œæé«˜ç›®æ ‡ç»“æœçš„å‘½ä¸­ç‡ã€‚

![SPO-Result-3](https://s2.loli.net/2025/02/27/hlIEtDQgMVSpWoB.png)

### 10. æµ‹è¯•ä¼˜åŒ–åæç¤ºè¯

æœ€åï¼Œæˆ‘æµ‹è¯•äº†**è½®æ¬¡3**çš„ä¼˜åŒ–ç»“æœä¸­çš„æç¤ºè¯ï¼Œè¾“å…¥äº†ä¸€ä¸ªé—®ç­”ç¤ºä¾‹ä¸­ä¸å­˜åœ¨çš„é—®é¢˜ï¼ˆé¿å…æ‹Ÿåˆï¼‰ï¼Œå®ƒä¸ä»…è¾“å‡ºäº†è¯¦ç»†çš„æ¨ç†è¿‡ç¨‹ï¼Œå¾—åˆ°äº†æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸”éå¸¸å¥½åœ°å®Œæˆæˆ‘è®¾å®šçš„ä»»åŠ¡ç›®æ ‡ï¼Œæœ€åç”Ÿæˆäº†æˆ‘è¦æ±‚çš„è¾“å‡ºç»“æœã€‚

> ä¼˜åŒ–åçš„æç¤ºè¯æ˜¯å…·å¤‡é€šç”¨æ€§çš„ï¼Œå³ä½¿æ˜¯åœ¨å…¶ä»–çš„æ¨¡å‹æˆ–å‚æ•°é‡æ›´å°çš„æ¨¡å‹ä¸­ï¼Œä¹Ÿèƒ½éå¸¸å‡†ç¡®åœ°æŒ‡å¯¼æ¨¡å‹è¾“å‡ºé¢„æœŸçš„ç»“æœã€‚

![SPO-Prompt-Test](https://s2.loli.net/2025/02/27/ywOtq5jI9ngkEKL.png)

## æœ¬åœ°éƒ¨ç½² â€” ç¯å¢ƒå‡†å¤‡

### 1. æ‹‰å–é¡¹ç›®ï¼š
```bash
git clone https://github.com/Airmomo/SPO.git
```

### 2. è¿›å…¥é¡¹ç›®ç›®å½•ï¼š
```bash
cd SPO/
```

### 3. åˆ›å»ºå¹¶æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒï¼š
```bash
# Windows/macOS/Linux é€šç”¨å‘½ä»¤
python -m venv myenv

# å¦‚æœé‡åˆ° python å‘½ä»¤æ— æ•ˆï¼Œå°è¯•ç”¨å…·ä½“ç‰ˆæœ¬å·ï¼š
python3 -m venv myenv
```

### 4. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
- Windows ç³»ç»Ÿï¼š
```bash
# å¸¸è§„å‘½ä»¤æç¤ºç¬¦ï¼ˆCMDï¼‰
myenv\Scripts\activate.bat

# PowerShell
.\myenv\Scripts\Activate.ps1
```

- macOS/Linux ç³»ç»Ÿï¼š
```bash
source myenv/bin/activate
```

### 5. å®‰è£…ä¾èµ–ï¼š
```bash
pip install -e .
cd ../
```

## æœ¬åœ°è¿è¡Œ â€” å¿«é€Ÿå¼€å§‹ï¼

é¡¹ç›®æä¾›äº†æ›´åŠ å‹å¥½çš„äº¤äº’ä½“éªŒï¼Œå¯ä»¥ä½¿ç”¨ Streamlit Web ç•Œé¢æ¥é…ç½®LLMå’Œè¿è¡Œä¼˜åŒ–å™¨ã€‚

é¦–å…ˆï¼Œå®‰è£… Streamlitï¼š

```bash
pip install "streamlit~=1.42.0"
```

> å®‰è£…`Streamlit`åå¯èƒ½ä¼šæç¤ºå­˜åœ¨ä¾èµ–ç‰ˆæœ¬å†²çªï¼Œä¸ä¼šå½±å“æ­£å¸¸è¿è¡Œï¼Œå¯ä»¥å¿½ç•¥ï¼

ç„¶åè¿è¡Œ Web ç•Œé¢ï¼š

```bash
python -m streamlit run app.py
```

é»˜è®¤è¿è¡Œåœ¨8501ç«¯å£ï¼Œå¯åŠ¨åä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—®`http://localhost:8501/`.

## å‘½ä»¤è¡Œè¿è¡Œ

### 1. é…ç½® API å¯†é’¥å’Œå‚æ•°

åœ¨è¿è¡Œ PromptOptimizer ä¹‹å‰ï¼Œéœ€è¦é…ç½®è¯­è¨€æ¨¡å‹ (LLM) çš„å‚æ•°ã€‚è¿™äº›å‚æ•°å¯ä»¥åœ¨ `config/config2.yaml` æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä½ å¯ä»¥å‚è€ƒ `examples/spo/config2.example.yaml` æ–‡ä»¶çš„æ ¼å¼è¿›è¡Œé…ç½®ã€‚

### 2. å®šä¹‰è¿­ä»£æ¨¡æ¿

åˆ›å»ºä¸€ä¸ªè¿­ä»£æ¨¡æ¿æ–‡ä»¶ `metagpt/ext/spo/settings/task_name.yaml`ï¼Œæ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š

```yaml
prompt: |
  Please solve the following problem.

requirements: |
  ...

count: None

qa:
  - question: |
      ...
    answer: |
      ...

  - question: |
      ...
    answer: |
      ...
```

#### æ¨¡æ¿å­—æ®µè¯´æ˜ï¼š
- **prompt**ï¼šè¿­ä»£çš„åˆå§‹æç¤ºã€‚
- **requirements**ï¼šæœŸæœ›çš„æ•ˆæœæˆ–ç»“æœï¼ˆä¾‹å¦‚ï¼Œç”Ÿæˆæ›´å¤šæ€è€ƒæˆ–ä½¿ç”¨æ›´å¹½é»˜çš„è¯­è¨€ï¼‰ã€‚
- **count**ï¼šç”Ÿæˆæç¤ºçš„ç›®æ ‡å­—æ•°ï¼ˆä¾‹å¦‚ï¼Œ50ï¼‰ã€‚è®¾ç½®ä¸º `None` è¡¨ç¤ºä¸é™åˆ¶å­—æ•°ã€‚
- **qa**ï¼šç”¨äºè¿­ä»£çš„é—®ç­”å¯¹ï¼Œé€šå¸¸åŒ…å« 3 ä¸ªå·¦å³çš„é—®ç­”å¯¹ã€‚
  - **question**ï¼šæ•°æ®é›†ä¸­ç”¨äºè¿­ä»£çš„é—®é¢˜ã€‚
  - **answer**ï¼šå¯¹åº”çš„ç­”æ¡ˆï¼Œå¯ä»¥åŒ…å«æœŸæœ›çš„æ€è€ƒæ¨¡å¼æˆ–å“åº”ï¼Œä¹Ÿå¯ä»¥ç•™ç©ºã€‚

å‚è€ƒç¤ºä¾‹ï¼š`metagpt/ext/spo/settings/Navigate.yaml`

---

### 3. å®ç° PromptOptimizer

PromptOptimizer æä¾›äº†ä¸‰ç§è¿è¡Œæ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ Python è„šæœ¬ã€å‘½ä»¤è¡Œæ¥å£å’Œ Streamlit Web ç•Œé¢ã€‚

#### é€šè¿‡ Python è„šæœ¬è¿è¡Œ

ä»¥ä¸‹æ˜¯é€šè¿‡ Python è„šæœ¬è¿è¡Œ PromptOptimizer çš„ç¤ºä¾‹ä»£ç ï¼š

```python
from metagpt.ext.spo.components.optimizer import PromptOptimizer
from metagpt.ext.spo.utils.llm_client import SPO_LLM

if __name__ == "__main__":
    # åˆå§‹åŒ– LLM è®¾ç½®
    SPO_LLM.initialize(
        optimize_kwargs={"model": "claude-3-5-sonnet-20240620", "temperature": 0.7},
        evaluate_kwargs={"model": "gpt-4o-mini", "temperature": 0.3},
        execute_kwargs={"model": "gpt-4o-mini", "temperature": 0}
    )

    # åˆ›å»ºå¹¶è¿è¡Œä¼˜åŒ–å™¨
    optimizer = PromptOptimizer(
        optimized_path="workspace",  # è¾“å‡ºç›®å½•
        initial_round=1,  # èµ·å§‹è½®æ¬¡
        max_rounds=10,  # æœ€å¤§ä¼˜åŒ–è½®æ¬¡
        template="Poem.yaml",  # æ¨¡æ¿æ–‡ä»¶
        name="Poem",  # é¡¹ç›®åç§°
    )

    optimizer.optimize()
```

#### é€šè¿‡å‘½ä»¤è¡Œæ¥å£è¿è¡Œ

è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥å£å¯åŠ¨ä¼˜åŒ–å™¨ï¼š

```bash
python -m examples.spo.optimize
```

å¯ç”¨çš„å‘½ä»¤è¡Œé€‰é¡¹å¦‚ä¸‹ï¼š

```
--opt-model            ç”¨äºä¼˜åŒ–çš„æ¨¡å‹ï¼ˆé»˜è®¤ï¼šclaude-3-5-sonnet-20240620ï¼‰
--opt-temp            ä¼˜åŒ–çš„æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤ï¼š0.7ï¼‰
--eval-model          ç”¨äºè¯„ä¼°çš„æ¨¡å‹ï¼ˆé»˜è®¤ï¼šgpt-4o-miniï¼‰
--eval-temp          è¯„ä¼°çš„æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤ï¼š0.3ï¼‰
--exec-model          ç”¨äºæ‰§è¡Œçš„æ¨¡å‹ï¼ˆé»˜è®¤ï¼šgpt-4o-miniï¼‰
--exec-temp          æ‰§è¡Œçš„æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤ï¼š0ï¼‰
--workspace          è¾“å‡ºç›®å½•è·¯å¾„ï¼ˆé»˜è®¤ï¼šworkspaceï¼‰
--initial-round      åˆå§‹è½®æ¬¡ç¼–å·ï¼ˆé»˜è®¤ï¼š1ï¼‰
--max-rounds        æœ€å¤§è½®æ¬¡æ•°é‡ï¼ˆé»˜è®¤ï¼š10ï¼‰
--template          æ¨¡æ¿æ–‡ä»¶åç§°ï¼ˆé»˜è®¤ï¼šPoem.yamlï¼‰
--name              é¡¹ç›®åç§°ï¼ˆé»˜è®¤ï¼šPoemï¼‰
```

æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ï¼š

```bash
python -m examples.spo.optimize --help
```

---

### 4. æŸ¥çœ‹ç»“æœ

ä¼˜åŒ–å®Œæˆåï¼Œç»“æœå°†å­˜å‚¨åœ¨ `workspace` ç›®å½•ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```
workspace
  â””â”€â”€ Project_name
      â””â”€â”€ prompts
          â”œâ”€â”€ results.json 
          â”œâ”€â”€ round_1
          â”‚   â”œâ”€â”€ answers.txt
          â”‚   â””â”€â”€ prompt.txt
          â”œâ”€â”€ round_2
          â”‚   â”œâ”€â”€ answers.txt
          â”‚   â””â”€â”€ prompt.txt
          â”œâ”€â”€ round_3
          â”‚   â”œâ”€â”€ answers.txt
          â”‚   â””â”€â”€ prompt.txt
          â”œâ”€â”€ ...
          â””â”€â”€ round_n
              â”œâ”€â”€ answers.txt
              â””â”€â”€ prompt.txt
```

æ–‡ä»¶è¯´æ˜ï¼š
- **results.json**ï¼šå­˜å‚¨æ¯è½®è¿­ä»£æ˜¯å¦æˆåŠŸåˆ¤æ–­åŠå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚
- **prompt.txt**ï¼šå¯¹åº”è½®æ¬¡çš„ä¼˜åŒ–æç¤ºã€‚
- **answers.txt**ï¼šä½¿ç”¨è¯¥æç¤ºç”Ÿæˆçš„è¾“å‡ºç»“æœã€‚

# Citation

If you use SPO in your research, please cite our paper:

```
@misc{xiang2025spo,
      title={Self-Supervised Prompt Optimization}, 
      author={Jinyu Xiang and Jiayi Zhang and Zhaoyang Yu and Fengwei Teng and Jinhao Tu and Xinbing Liang and Sirui Hong and Chenglin Wu and Yuyu Luo},
      year={2025},
      eprint={2502.06855},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2502.06855}, 
}
```